###
 require
###

http= require('http')
spawn= require('child_process').spawn

server = http.createServer (req, res) ->
  res.writeHead 200,
    'Content-Type': 'text/plain'

  tail_child = spawn('tail' , ['-f', '/var/log/system.log']) 
  
  req.connection.on 'end', ->
    tail_child.kill()
  
  tail_child.stdout.on 'data', (data) ->
    console.log data.toString()  
    # This res.write line may cause a problem
    res.write(data)
  
server.listen 4000
