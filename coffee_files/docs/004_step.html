<!DOCTYPE html>  <html> <head>   <title>004_step.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="000_intro.html">                 000_intro.coffee               </a>                                           <a class="source" href="001_http.html">                 001_http.coffee               </a>                                           <a class="source" href="002_child_process.html">                 002_child_process.coffee               </a>                                           <a class="source" href="003_pump.html">                 003_pump.coffee               </a>                                           <a class="source" href="004_step.html">                 004_step.coffee               </a>                                           <a class="source" href="005_chat.html">                 005_chat.coffee               </a>                                           <a class="source" href="006_socket_chat.html">                 006_socket_chat.coffee               </a>                                           <a class="source" href="007_socket.io_chat.html">                 007_socket.io_chat.coffee               </a>                                           <a class="source" href="008_0_connect.html">                 008_0_connect.coffee               </a>                                           <a class="source" href="008_1_serve-js.html">                 008_1_serve-js.coffee               </a>                                           <a class="source" href="008_2_log-it.html">                 008_2_log-it.coffee               </a>                                           <a class="source" href="009_express.html">                 009_express.coffee               </a>                                           <a class="source" href="010_0_express2.html">                 010_0_express2.coffee               </a>                                           <a class="source" href="010_1_products.html">                 010_1_products.coffee               </a>                                           <a class="source" href="011_express2.html">                 011_express2.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               004_step.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Steps</h1>

<hr />

<ul>
<li><a href="https://github.com/creationix/step">Step </a> - An async control-flow library that makes stepping through logic easy.</li>
</ul>

<hr />             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">http= </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
<span class="nv">fs= </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
<span class="nv">step= </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">)</span>

<span class="nv">file_path = </span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/asset/cat.jpg&#39;</span>
<span class="nv">file_size = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The step library exports a single function called Step. It accepts any number of functions as arguments and runs them in serial order using the passed in this context as the callback to the next step.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">step</span> <span class="nv">get_file_size = </span><span class="o">-&gt;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span> <span class="nx">file_path</span><span class="p">,</span> <span class="k">this</span>
<span class="p">,</span> <span class="nv">store_file_size = </span><span class="nf">(err, stat) -&gt;</span>
  <span class="k">throw</span> <span class="nx">err</span>  <span class="k">if</span> <span class="nx">err</span>
  <span class="nv">file_size = </span><span class="nx">stat</span><span class="p">.</span><span class="nx">size</span>
  <span class="k">this</span>
<span class="p">,</span> <span class="nv">read_file_into_memory = </span><span class="nf">() -&gt;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="nx">file_path</span><span class="p">,</span> <span class="k">this</span>
<span class="p">,</span> <span class="nv">create_server = </span><span class="nf">(err, file_content) -&gt;</span>   
  <span class="k">throw</span> <span class="nx">err</span>  <span class="k">if</span> <span class="nx">err</span> 
  <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span> <span class="nf">(request, response) -&gt;</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span> <span class="mi">200</span><span class="p">,</span>
      <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;image/jpeg&#39;</span>
      <span class="s1">&#39;Content-Length&#39;</span><span class="o">:</span> <span class="nx">file_size</span> 
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span> <span class="nx">file_content</span>
  <span class="p">.</span><span class="nx">listen</span> <span class="mi">4000</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 